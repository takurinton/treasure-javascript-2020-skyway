{"version":3,"sources":["style/theme.ts","components/Header.tsx","components/Top.tsx","pages/Home.tsx","api/postText.ts","hooks/useText.ts","recognition/Recognition.ts","pages/Room.tsx","App.tsx","index.tsx"],"names":["theme","createMuiTheme","palette","primary","light","main","dark","contrastText","secondary","HeaderStyle","makeStyles","createStyles","root","marginBottom","flexGrow","title","textAlign","link","color","textDecoration","HomeStyle","marginRight","marginLeft","width","topPage","paddingTop","paddingBottom","inputText","button","RoomStyle","display","room","camera","margin","inputID","marginTop","Header","classes","AppBar","position","className","Toolbar","IconButton","edge","aria-label","Typography","variant","Link","href","Top","Box","Home","history","useHistory","useState","name","setName","onSubmit","e","push","pathname","state","Input","onChange","target","value","required","type","placeholder","Button","postText","body","a","fetch","method","credentials","JSON","stringify","initialState","contents","useText","setState","handleSubmit","RecognitionEffect","r","window","webkitSpeechRecognition","running","onFinal","onProgress","onError","this","continuous","interimResults","onresult","i","resultIndex","results","length","isFinal","transcript","onerror","err","console","warn","start","stop","Room","inputButton","peer","Peer","key","n","useLocation","myId","setMyId","callId","setCallId","me","useRef","to","recognition","setProgress","speech","setSpeech","useEffect","on","id","navigator","mediaDevices","getUserMedia","video","audio","then","localStream","current","srcObject","mediaConnection","answer","stream","c","toggle","userName","log","undefined","autoPlay","muted","playsInline","ref","onClick","call","play","catch","error","App","alignItems","exact","path","component","ReactDOM","render","StrictMode","Grid","document","getElementById"],"mappings":"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","file":"static/js/main.b57fe57c.chunk.js","sourcesContent":["import { createStyles, makeStyles, Theme, createMuiTheme } from '@material-ui/core/styles'\n\nexport const theme = createMuiTheme({\n    palette: {\n        primary: {\n          light: '#ffff8b',\n          main: '#81c784',\n          dark: '#c9bc1f',\n          contrastText: '#000000',\n        },\n        secondary: {\n          light: '#63a4ff',\n          main: '#1976d2',\n          dark: '#004ba0',\n          contrastText: '#ffffff',\n        },\n      },\n  });\n\nexport const HeaderStyle = makeStyles(() =>\n  createStyles({\n    root: {\n      marginBottom: \"3%\",\n      flexGrow: 1,\n    },\n    title: {\n      flexGrow: 1,\n      textAlign: \"center\", \n    }, \n    link: {\n      color: \"#000\", \n      textDecoration: \"none\", \n    }\n  })\n);\n\nexport const HomeStyle = makeStyles(() => \n    createStyles({\n        root: {\n            marginRight: 'auto', \n            marginLeft: 'auto', \n            width: '50%', \n            textAlign: 'center', \n        },\n        topPage: {\n            paddingTop: '3%', \n            paddingBottom: '10%'\n        }, \n        inputText: {\n            width: '80%', \n\n        }, \n        button: {\n            marginLeft: '2%', \n            width: '18%', \n        }\n    })\n)\n\nexport const RoomStyle = makeStyles(() =>\n    createStyles({\n        root: {\n            display: 'block', \n            width: '820px', \n            marginRight: 'auto', \n            marginLeft: 'auto'\n        }, \n        room: {\n            display: 'flex'\n        }, \n        camera: {\n            margin: '10px'\n        }, \n        inputID: {\n            marginTop: '5%', \n            marginRight: 'auto', \n            marginLeft: 'auto', \n            width: '80%'\n        },\n    })\n)","import React from 'react';\n\nimport AppBar from '@material-ui/core/AppBar'\nimport Toolbar from '@material-ui/core/Toolbar'\nimport IconButton from '@material-ui/core/IconButton'\nimport Typography from '@material-ui/core/Typography'\nimport Link from '@material-ui/core/Link'\n\nimport { HeaderStyle } from '../style/theme'\n\n\n\nconst Header = () => {\n    const classes = HeaderStyle()\n    return (\n        <AppBar position=\"static\" className={classes.root}>\n            <Toolbar>\n                <IconButton edge=\"start\"  color=\"inherit\" aria-label=\"menu\">\n                </IconButton>\n                <Typography variant=\"h6\" className={classes.title}>\n                    <Link href=\"/textapp/#/\" className={classes.link}>Takurinton skyway app</Link>\n                </Typography>\n            </Toolbar>\n        </AppBar>\n    )\n}\n\nexport default Header","import React, { FunctionComponent } from 'react'\n\nimport Box from '@material-ui/core/Box'\nimport { HomeStyle } from '../style/theme'\nimport { Typography } from '@material-ui/core'\n\nconst Top:FunctionComponent<{}> = () => {\n    const classes = HomeStyle()\n    return (\n        <Box className={classes.topPage}>\n            <Typography variant='h2'>\n                Takurinton hoge app\n            </Typography>\n        </Box>\n    )\n}\nexport default Top\n","import React, { useState, FunctionComponent } from 'react';\nimport { useHistory } from 'react-router-dom'\n\nimport Button from '@material-ui/core/Button'\nimport Input from '@material-ui/core/Input'\nimport Box from '@material-ui/core/Box'\nimport Top from '../components/Top'\nimport { HomeStyle } from '../style/theme'\n\nconst Home:FunctionComponent<{}>  = () => {\n    const classes = HomeStyle()\n    let history = useHistory()\n    const [name, setName] = useState<string>('')\n\n    const onChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n        setName(e.target.value)\n    }\n    const onSubmit = (e: React.FormEvent<HTMLFormElement>) => {\n        history.push({\n            pathname: \"/room\",\n            state: name\n        })\n    }\n    return (\n        <Box className={classes.root}>\n            <Top />\n            <form onSubmit={onSubmit}>\n                <Input onChange={onChange} required={true} value={name} type=\"text\" name=\"name\" placeholder='名前を入力してください' className={classes.inputText} />\n                <Button type=\"submit\" variant=\"contained\" color=\"primary\" className={classes.button} >次へ</Button>\n            </form>\n        </Box>\n    )\n}\n\nexport default Home","interface Body {\n    name:string\n    contents:string\n}\n\nconst postText = async (body: Body) => {\n    await fetch(`https://script.google.com/macros/s/AKfycbznp9P5nNsXuOQP-9zQTcRdXeeJfpx_JaBXXikvFm4L2PK3Z_Dx/exec`, {\n        method: \"POST\",\n        credentials: \"same-origin\",\n        body: JSON.stringify(body), \n    })\n}\n\nexport default postText\n\n","import React, { useState } from 'react'\n\nimport postText from '../api/postText'\n\ninterface Body {\n    name: string\n    contents: string \n}\n\nconst initialState:Body = {\n    name: \"\", \n    contents: \"\"\n}\n\nconst useText = () => {\n    const [state, setState] = useState<Body>(initialState)\n\n    const handleSubmit = (body:Body) => {\n        postText(body)\n        setState(initialState)\n    }\n\n    return {\n        state, \n        handleSubmit\n    }\n}\n\nexport default useText","// ほぼコピペ\n// 修正するところはしましょう\nexport class RecognitionEffect {\n    r: SpeechRecognition = new (window as any).webkitSpeechRecognition();\n    running = false;\n  \n    onFinal?: (c: string) => void;\n    onProgress?: (c: string) => void;\n    onError?: () => void;\n  \n    constructor() {\n      this.r.continuous = true;\n      this.r.interimResults = true;\n  \n      this.r.onresult = (e) => {\n        for (let i = e.resultIndex; i < e.results.length; ++i) {\n          if (e.results[i].isFinal) {\n            if (this.onFinal) this.onFinal(e.results[i][0].transcript);\n          } else {\n            // eslint-disable-next-line no-lonely-if\n            if (this.onProgress) this.onProgress(e.results[i][0].transcript);\n          }\n        }\n      };\n  \n      this.r.onerror = (err) => {\n        console.warn(err);\n        if (this.onError) this.onError();\n      };\n      this.start();\n    }\n  \n    start() {\n      this.running = true;\n      this.r.start();\n    }\n  \n    stop() {\n      this.running = false;\n      this.r.stop();\n    }\n  \n    // start stop 切り替え　\n    toggle() {\n      if (this.running) {\n        this.stop();\n      } else {\n        this.start();\n      }\n  }\n}","import React, { useState, useRef, useEffect , FunctionComponent } from 'react'\nimport { useLocation } from 'react-router-dom'\nimport Peer from 'skyway-js'\n\nimport useText from '../hooks/useText'\nimport { RecognitionEffect } from '../recognition/Recognition'\n\nimport Button from '@material-ui/core/Button';\nimport Input from '@material-ui/core/Input'\nimport Box from '@material-ui/core/Box'\nimport { Typography } from '@material-ui/core'\n\nimport { RoomStyle, HomeStyle } from '../style/theme'\n\nconst Room:FunctionComponent<{}> = () => {\n    const classes = RoomStyle()\n    const inputButton = HomeStyle()\n    const PEER_KEY = 'f4314d6c-ad3c-450c-90df-2811611d4a25'\n    const peer: Peer = new Peer({ key: PEER_KEY }) // 隠した方が良いかも？\n    let location = useLocation()\n    const n: string | unknown = location.state\n    if (typeof n === 'string') {\n        var name:string = n\n    }\n    const [myId, setMyId] = useState<string>('')\n    const [callId, setCallId] = useState<string>('')\n    const me: React.MutableRefObject<any> = useRef(null)\n    const to: React.MutableRefObject<any>  = useRef(null)\n    const recognition = useRef<RecognitionEffect>();\n    const [progress, setProgress] = useState(\"\");\n    const [speech, setSpeech] = useState<string>('')\n    \n    const {\n        state, \n        handleSubmit\n    } = useText()\n\n    const openCall = () => {\n      peer.on('open', () => {\n        setMyId(peer.id)\n        navigator.mediaDevices.getUserMedia({ \n          video: true, \n          audio: true \n        })\n        .then(localStream => {\n          me.current.srcObject = localStream\n        })\n      })\n      \n      peer.on('call', mediaConnection => {\n        mediaConnection.answer(me.current.srcObject)\n        mediaConnection.on('stream', async stream => {\n          to.current.srcObject = stream\n        })\n      })\n    }\n\n    const makeCall = () => {\n      const mediaConnection = peer.call(callId, me.current.srcObject)\n      mediaConnection.on('stream', async stream => {\n        to.current.srcObject = stream\n        await to.current.play().catch(console.error)\n      })\n    }\n\n    // 1回だけ実行、これより良い方法全然ありそう\n    useEffect(( ) => {\n      openCall()\n    }, [])\n\n    useEffect(() => {\n      const r = (recognition.current = new RecognitionEffect());\n      r.onFinal = (c) => {\n        r.toggle()\n        setSpeech(c)\n        const userName = name\n        state.name = userName\n        state.contents = c\n        handleSubmit(state)\n      }\n      r.onError = () => {      \n        console.log('error')\n      };\n      r.onProgress = setProgress;\n    }, [speech]);\n    \n    return (\n      <Box className={classes.root}>\n        <Box className={classes.room}>\n          <Box className={classes.camera}>\n            <Typography variant=\"h4\">\n              You: {typeof n === undefined ? '' : n}\n            </Typography>\n              <video width=\"400px\" autoPlay muted playsInline ref={me} />\n              <p>Your ID : {myId}</p>\n          </Box>\n          <Box className={classes.camera}>\n          <Typography variant=\"h4\">\n            Your friend\n          </Typography>\n            <video width=\"400px\" autoPlay muted playsInline ref={to}/>\n          </Box>\n        </Box>\n        <Box className={classes.inputID} >\n          <Input value={callId} onChange={e => setCallId(e.target.value)} placeholder=\"通話相手のIDを入力してください\" className={inputButton.inputText} />\n          <Button onClick={makeCall} variant=\"contained\" color=\"primary\" className={inputButton.button} >発信</Button>\n        </Box>\n      </Box>\n    )\n}\n\nexport default Room","import React, { FunctionComponent } from 'react';\nimport { HashRouter as Router, Switch, Route } from 'react-router-dom'\n\nimport Header from '../src/components/Header'\nimport Home from '../src/pages/Home'\nimport Room from '../src/pages/Room'\n\nimport Box from '@material-ui/core/Box'\n\n\nconst App:FunctionComponent<{}> = () => {\n  return (\n    <Box alignItems=\"center\">\n      <Header />\n      <Router>\n        <Switch>\n          <Route exact path='/' component={Home}/>\n          <Route exact path='/room' component={Room}/>\n        </Switch>\n      </Router>\n    </Box>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nimport Grid from '@material-ui/core/Grid';\nimport {　MuiThemeProvider　} from '@material-ui/core/styles'\nimport { theme } from '../src/style/theme'\n\nReactDOM.render(\n  <React.StrictMode>\n    <Grid>\n      <MuiThemeProvider theme={theme}>\n        <App />  \n      </MuiThemeProvider>\n    </Grid>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}